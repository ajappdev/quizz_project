{% extends "base.html" %}
{% load i18n %}
{% load humanize %}
{% load static %}


{% block page_content %}

{% csrf_token %}
    <div class="container">
    <div class="row">
        
        <div class="col-lg-6 col-12 col-md-12 mb-3">

            <div style="overflow-x: auto; max-height:300px;" class="card h-100 d-inline-block w-100">
                <div class="card-body">
                    <h5 class="card-title">{% trans 'Regions' %}</h5><button id="add_region_button" class="add_button_settings btn btn-sm btn-success"><i class="fas fa-plus"></i></button>
                    <input class="search_element_field form-control" type="text" placeholder="&#128269; {% trans 'Search for region' %}">
                </div>

                <table class="table align-middle mb-0 bg-white">

                    <tbody id="tbody_regions">
                    {% for region in regions %}
                            <tr>
                                <td class="hidden region_id">
                                    {{region.id|safe}}
                                </td>
                                <td class="region_name name_field">
                                    {{region.name}}
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_region_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_region_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>

        </div>

        <div class="col-lg-6 col-12 col-md-12 mb-3">

            <div style="overflow-x: auto; max-height:300px;" class="card h-100 d-inline-block w-100">
                <div class="card-body">
                    <h5 class="card-title">{% trans 'Countries' %}</h5><button id="add_country_button" class="add_button_settings btn btn-sm btn-success"><i class="fas fa-plus"></i></button>
                    <input class="search_element_field form-control" type="text" placeholder="&#128269; {% trans 'Search for country' %}">
                </div>

                <table class="table align-middle mb-0 bg-white">
                    <tbody  id="tbody_countries">
                    {% for country in countries %}
                            <tr>
                                <td class="hidden country_id">
                                    {{country.id|safe}}
                                </td>
                                <td class="country_name name_field">
                                    {{country.name}}
                                </td>
                                <td class="country_region">
                                    {{country.region.all|join:", "}}<span class="hidden country_region_id">{% for region in country.region.all %} {{region.id|safe}}, {% endfor %}</span>
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_country_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_country_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>

        </div>


        <div class="col-lg-6 col-12 col-md-12 mb-3">

            <div style="overflow-x: auto; max-height:300px;" class="card h-100 d-inline-block w-100">
                <div class="card-body">
                    <h5 class="card-title">{% trans 'Categories' %}</h5><button id="add_category_button" class="add_button_settings btn btn-sm btn-success"><i class="fas fa-plus"></i></button>
                    <input class="search_element_field form-control" type="text" placeholder="&#128269; {% trans 'Search for category' %}">
                </div>

                <table class="table align-middle mb-0 bg-white">

                    <tbody id="tbody_categories">
                    {% for category in categories %}
                            <tr>
                                <td class="hidden category_id">
                                    {{category.id|safe}}
                                </td>
                                <td class="category_name name_field">
                                    {{category.name}}
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_category_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_category_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>

        </div>


        <div class="col-lg-6 col-12 col-md-12 mb-3">

            <div style="overflow-x: auto; max-height:300px;" class="card h-100 d-inline-block w-100">
                <div class="card-body">
                    <h5 class="card-title">{% trans 'Sub Categories' %}</h5><button id="add_sub_category_button" class="add_button_settings btn btn-sm btn-success"><i class="fas fa-plus"></i></button>
                    <input class="search_element_field form-control" type="text" placeholder="&#128269; {% trans 'Search for sub category' %}">
                </div>

                <table class="table align-middle mb-0 bg-white">
                    <tbody  id="tbody_sub_categories">
                    {% for sub_category in sub_categories %}
                            <tr>
                                <td class="hidden sub_category_id">
                                    {{sub_category.id|safe}}
                                </td>
                                <td class="sub_category_name name_field">
                                    {{sub_category.name}}
                                </td>
                                <td class="sub_category_parent_category">
                                    {{sub_category.category.all|join:", "}}<span class="hidden sub_category_parent_category_id">{% for category in sub_category.category.all %} {{category.id|safe}}, {% endfor %}</span>
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_sub_category_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_sub_category_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>

        </div>


</div>
</div>

<style>

.search_element_field
{
    width: 100%;
    max-width: 300px;
}

</style>

<script
  src="https://code.jquery.com/jquery-3.6.1.js"
  integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
  crossorigin="anonymous"></script>
<script>

//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
/////////////////////////////AT LOAD//////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////




//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
////////////////////////WHEN DOM READY//////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////

$( document ).ready(function() {


var current_regions = get_current_regions()
var current_categories = get_current_categories()

});


//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
////////////////////////CLIC EVENTS//////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////


$(document).on("click", "#add_region_button", function() {


Swal.fire({
    title: translate_js('Add region', "EN"),
    html: `<input class="form-control" placeholder="{% trans 'Region name' %}"id="region_name_field" name="region_name_field">`,
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: translate_js('Confirm', "EN"),
    cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
    if (result.isConfirmed) {

        data_dict = {
            "function":"add_region", "region_name": $("#region_name_field").val().trim()
            }
            region_name_value = $("#region_name_field").val().trim()
            $.ajax({
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            type: 'POST',
            processData: false,
            contentType: false,
            url: "{% url 'ajax_calls' %}",
            data: JSON.stringify(data_dict),
            success: function(response) {
                if (response['error'] != "0")
                {
                    Swal.fire({
                        icon: 'error',
                        title: translate_js('An error has occurred!', "EN"),
                        position: 'center',
                        showConfirmButton: false,
                        text: translate_js(response['error_text'], "EN"),
                    })
                }else
                {

                    $("#tbody_regions").append(`
                            <tr>
                                <td class="hidden region_id">
                                    `+response['new_region_id']+`
                                </td>
                                <td class="region_name">
                                    `+region_name_value+`
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_region_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_region_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>`)

                    Swal.fire({
                        icon: 'success',
                        title: translate_js("Region successfully created!", "EN"),
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
                current_regions = get_current_regions()
            }
            })


    }
})
})


$(document).on("click", ".update_region_button", function() {

region_id = $(this).closest("tr").find(".region_id").text()
region_row = $(this).closest("tr")

Swal.fire({
title: translate_js('Update region', "EN"),
html:  `<input class="form-control" placeholder="{% trans 'Region name' %}" id="region_name_field" name="region_name_field" value="`+$(this).closest("tr").find(".region_name").text().trim()+`">`,
showCancelButton: true,
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {
    region_name_field = $("#region_name_field").val().trim()
    data_dict = {
        "function":"update_region", "region_name": region_name_field, "region_id": region_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                region_row.html(`
                            <td class="hidden region_id">
                                `+region_id+`
                            </td>
                            <td class="region_name">
                                `+region_name_field+`
                            </td>
                            <td style="white-space: nowrap;" class="text-end">
                                <button class="update_region_button btn btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_region_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                            </td>`)

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Region successfully updated!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }
            current_regions = get_current_regions()
        }
        })


}
})
})

$(document).on("click", ".delete_region_button", function() {

region_id = $(this).closest("tr").find(".region_id").text()
region_row = $(this).closest("tr")
Swal.fire({
title: translate_js('Delete region', "EN"),
text: translate_js('Do you really want to delete this region?', "EN"),
showCancelButton: true,
icon: 'warning',
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {

    data_dict = {
        "function":"delete_region", "region_id": region_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                region_row.remove()

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Region successfully deleted!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }
            current_regions = get_current_regions()
        }
        })


}
})
})


/////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////



$(document).on("click", "#add_country_button", function() {

Swal.fire({
    title: translate_js('Add country', "EN"),
    html: `<input class="mb-3 form-control" placeholder="{% trans 'Country name' %}"id="country_name_field" name="country_name_field">
            <select class="form-control" id="country_region_field" name="country_region_field" multiple>
                <option disabled value="">{% trans 'Country region' %}</option>
                ` + current_regions + `
            </select>`,
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: translate_js('Confirm', "EN"),
    cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
    if (result.isConfirmed) {

        data_dict = {
            "function":"add_country", "country_name": $("#country_name_field").val().trim(), "region_id": $("#country_region_field").val()
            }
            country_name_value = $("#country_name_field").val().trim()

            country_region_value = ""
            $("#country_region_field option:selected").each(function () {
                country_region_value = country_region_value + $(this).text() + ", "
            });
            country_region_value = country_region_value.slice(0,-2)

            country_region_id = $("#country_region_field").val()
            $.ajax({
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            type: 'POST',
            processData: false,
            contentType: false,
            url: "{% url 'ajax_calls' %}",
            data: JSON.stringify(data_dict),
            success: function(response) {
                if (response['error'] != "0")
                {
                    Swal.fire({
                        icon: 'error',
                        title: translate_js('An error has occurred!', "EN"),
                        position: 'center',
                        showConfirmButton: false,
                        text: translate_js(response['error_text'], "EN"),
                    })
                }else
                {

                    $("#tbody_countries").append(`
                            <tr>
                                <td class="hidden country_id">
                                    `+response['new_country_id']+`
                                </td>
                                <td class="country_name">
                                    `+country_name_value+`
                                </td>
                                <td class="country_region">
                                    `+country_region_value+`<span class="hidden country_region_id">`+country_region_id+`</span>
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_country_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_country_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>`)

                    Swal.fire({
                        icon: 'success',
                        title: translate_js("Country successfully created!", "EN"),
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
            }
            })


    }
})
})


$(document).on("keyup", ".search_element_field", function() {

    searched_value = $(this).val()
    $($(this).closest(".card").find(".name_field")).each(function() {
        if ($(this).text().toLowerCase().indexOf(searched_value.toLowerCase()) == -1 )
        {
            $(this).closest("tr").hide("")
        }else
        {
            $(this).closest("tr").show("")
        }

    });

});

$(document).on("click", ".update_country_button", function() {

country_id = $(this).closest("tr").find(".country_id").text()
country_row = $(this).closest("tr")
country_region_id = $(this).closest("tr").find(".country_region_id").text()
ids = []
for (i=0; i<country_region_id.split(",").length; i++)
{
    ids.push(parseInt(country_region_id.split(",")[i]).toString())
}
console.log(ids)
Swal.fire({
title: translate_js('Update country', "EN"),
html:  `<input class="mb-3 form-control" placeholder="{% trans 'country name' %}" id="country_name_field" name="country_name_field" value="`+$(this).closest("tr").find(".country_name").text().trim()+`">
        <select class="form-control" id="country_region_field" name="country_region_field" multiple>
            <option disabled value="">{% trans 'Country region' %}</option>
            ` + current_regions + `
        </select>`,
showCancelButton: true,
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {
    country_name_field = $("#country_name_field").val().trim()
    country_region_field = ""
    $("#country_region_field option:selected").each(function () {
        country_region_field = country_region_field + $(this).text() + ", "
    });
    country_region_field = country_region_field.slice(0,-2)
    country_region_id = $("#country_region_field").val()
    data_dict = {
        "function":"update_country", "country_name": country_name_field, "country_region": country_region_id, "country_id": country_id
        }
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                country_row.html(`
                            <td class="hidden country_id">
                                `+country_id+`
                            </td>
                            <td class="country_name">
                                `+country_name_field+`
                            </td>
                            <td class="country_region">
                                `+country_region_field+`<span class="hidden country_region_id">`+country_region_id+`</span>
                            </td>
                            <td style="white-space: nowrap;" class="text-end">
                                <button class="update_country_button btn btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_country_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                            </td>`)

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Country successfully updated!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }

        }
        })


}
})

$("#country_region_field").val(ids)

})

$(document).on("click", ".delete_country_button", function() {

country_id = $(this).closest("tr").find(".country_id").text()
country_row = $(this).closest("tr")
Swal.fire({
title: translate_js('Delete country', "EN"),
text: translate_js('Do you really want to delete this country?', "EN"),
showCancelButton: true,
icon: 'warning',
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {

    data_dict = {
        "function":"delete_country", "country_id": country_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                country_row.remove()

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Country successfully deleted!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }

        }
        })


}
})
})







/////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////



$(document).on("click", "#add_sub_category_button", function() {

Swal.fire({
    title: translate_js('Add sub category', "EN"),
    html: `<input class="mb-3 form-control" placeholder="{% trans 'Sub category name' %}"id="sub_category_name_field" name="sub_category_name_field">
            <select class="form-control" id="sub_category_parent_category_field" name="sub_category_parent_category_field" multiple>
                <option disabled value="">{% trans 'Parent category' %}</option>
                ` + current_categories + `
            </select>`,
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: translate_js('Confirm', "EN"),
    cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
    if (result.isConfirmed) {
        data_dict = {
            "function":"add_sub_category", "sub_category_name": $("#sub_category_name_field").val().trim(), "parent_category_id": $("#sub_category_parent_category_field").val()
            }
            sub_category_name_value = $("#sub_category_name_field").val().trim()

            sub_category_parent_category_value = ""
            $("#sub_category_parent_category_field option:selected").each(function () {
                sub_category_parent_category_value = sub_category_parent_category_value + $(this).text() + ", "
            });
            sub_category_parent_category_value = sub_category_parent_category_value.slice(0,-2)

            sub_category_parent_category_id = $("#sub_category_parent_category_field").val()
            $.ajax({
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            type: 'POST',
            processData: false,
            contentType: false,
            url: "{% url 'ajax_calls' %}",
            data: JSON.stringify(data_dict),
            success: function(response) {
                if (response['error'] != "0")
                {
                    Swal.fire({
                        icon: 'error',
                        title: translate_js('An error has occurred!', "EN"),
                        position: 'center',
                        showConfirmButton: false,
                        text: translate_js(response['error_text'], "EN"),
                    })
                }else
                {

                    $("#tbody_sub_categories").append(`
                            <tr>
                                <td class="hidden sub_category_id">
                                    `+response['new_sub_category_id']+`
                                </td>
                                <td class="sub_category_name">
                                    `+sub_category_name_value+`
                                </td>
                                <td class="sub_category_parent_category">
                                    `+sub_category_parent_category_value+`<span class="hidden sub_category_parent_category_id">`+sub_category_parent_category_id+`</span>
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_sub_category_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_sub_category_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>`)

                    Swal.fire({
                        icon: 'success',
                        title: translate_js("Sub category successfully created!", "EN"),
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
            }
            })


    }
})
})


$(document).on("click", ".update_sub_category_button", function() {

sub_category_id = $(this).closest("tr").find(".sub_category_id").text()
sub_category_row = $(this).closest("tr")
sub_category_parent_category_id = $(this).closest("tr").find(".sub_category_parent_category_id").text()

ids = []
for (i=0; i<sub_category_parent_category_id.split(",").length; i++)
{
    ids.push(parseInt(sub_category_parent_category_id.split(",")[i]).toString())
}

Swal.fire({
title: translate_js('Update sub_category', "EN"),
html:  `<input class="mb-3 form-control" placeholder="{% trans 'Sub category name' %}" id="sub_category_name_field" name="sub_category_name_field" value="`+$(this).closest("tr").find(".sub_category_name").text().trim()+`">
        <select class="form-control" id="sub_category_parent_category_field" name="sub_category_parent_category_field" multiple>
            <option disabled value="">{% trans 'Parent category' %}</option>
            ` + current_categories + `
        </select>`,
showCancelButton: true,
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {
    sub_category_name_field = $("#sub_category_name_field").val().trim()

    sub_category_parent_category_field = ""
    $("#sub_category_parent_category_field option:selected").each(function () {
        sub_category_parent_category_field = sub_category_parent_category_field + $(this).text() + ", "
    });
    sub_category_parent_category_field = sub_category_parent_category_field.slice(0,-2)
    country_region_id = $("#country_region_field").val()

    sub_category_parent_category_id = $("#sub_category_parent_category_field").val()
    data_dict = {
        "function":"update_sub_category", "sub_category_name": sub_category_name_field, "sub_category_parent_category": sub_category_parent_category_id, "sub_category_id": sub_category_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                sub_category_row.html(`
                            <td class="hidden sub_category_id">
                                `+sub_category_id+`
                            </td>
                            <td class="sub_category_name">
                                `+sub_category_name_field+`
                            </td>
                            <td class="sub_category_parent_category">
                                `+sub_category_parent_category_field+`<span class="hidden sub_category_parent_category_id">`+sub_category_parent_category_id+`</span>
                            </td>
                            <td style="white-space: nowrap;" class="text-end">
                                <button class="update_sub_category_button btn btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_sub_category_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                            </td>`)

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Sub category successfully updated!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }

        }
        })


}
})
$("#sub_category_parent_category_field").val(ids)

})

$(document).on("click", ".delete_sub_category_button", function() {

sub_category_id = $(this).closest("tr").find(".sub_category_id").text()
sub_category_row = $(this).closest("tr")
Swal.fire({
title: translate_js('Delete Sub category', "EN"),
text: translate_js('Do you really want to delete this sub category?', "EN"),
showCancelButton: true,
icon: 'warning',
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {

    data_dict = {
        "function":"delete_sub_category", "sub_category_id": sub_category_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                sub_category_row.remove()

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Sub category successfully deleted!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }

        }
        })


}
})
})








/////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////




$(document).on("click", "#add_category_button", function() {


Swal.fire({
    title: translate_js('Add category', "EN"),
    html: `<input class="form-control" placeholder="{% trans 'Category name' %}"id="category_name_field" name="category_name_field">`,
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: translate_js('Confirm', "EN"),
    cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
    if (result.isConfirmed) {

        data_dict = {
            "function":"add_category", "category_name": $("#category_name_field").val().trim()
            }
            category_name_value = $("#category_name_field").val().trim()
            $.ajax({
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            type: 'POST',
            processData: false,
            contentType: false,
            url: "{% url 'ajax_calls' %}",
            data: JSON.stringify(data_dict),
            success: function(response) {
                if (response['error'] != "0")
                {
                    Swal.fire({
                        icon: 'error',
                        title: translate_js('An error has occurred!', "EN"),
                        position: 'center',
                        showConfirmButton: false,
                        text: translate_js(response['error_text'], "EN"),
                    })
                }else
                {

                    $("#tbody_categories").append(`
                            <tr>
                                <td class="hidden category_id">
                                    `+response['new_category_id']+`
                                </td>
                                <td class="category_name">
                                    `+category_name_value+`
                                </td>
                                <td style="white-space: nowrap;" class="text-end">
                                    <button class="btn update_category_button btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_category_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>`)

                    Swal.fire({
                        icon: 'success',
                        title: translate_js("Category successfully created!", "EN"),
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
                current_categories = get_current_categories()
            }
            })


    }
})
})


$(document).on("click", ".update_category_button", function() {

category_id = $(this).closest("tr").find(".category_id").text()
category_row = $(this).closest("tr")

Swal.fire({
title: translate_js('Update category', "EN"),
html:  `<input class="form-control" placeholder="{% trans 'Category name' %}" id="category_name_field" name="category_name_field" value="`+$(this).closest("tr").find(".category_name").text().trim()+`">`,
showCancelButton: true,
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {
    category_name_field = $("#category_name_field").val().trim()
    data_dict = {
        "function":"update_category", "category_name": category_name_field, "category_id": category_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                category_row.html(`
                            <td class="hidden category_id">
                                `+category_id+`
                            </td>
                            <td class="category_name">
                                `+category_name_field+`
                            </td>
                            <td style="white-space: nowrap;" class="text-end">
                                <button class="update_category_button btn btn-sm btn-secondary"><i class="fas fa-edit"></i></button> <button class="delete_category_button btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                            </td>`)

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Category successfully updated!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }
            current_categories = get_current_categories()
        }
        })


}
})
})

$(document).on("click", ".delete_category_button", function() {

category_id = $(this).closest("tr").find(".category_id").text()
category_row = $(this).closest("tr")
Swal.fire({
title: translate_js('Delete category', "EN"),
text: translate_js('Do you really want to delete this category?', "EN"),
showCancelButton: true,
icon: 'warning',
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: translate_js('Confirm', "EN"),
cancelButtonText: translate_js('Cancel', "EN")
}).then((result) => {
if (result.isConfirmed) {

    data_dict = {
        "function":"delete_category", "category_id": category_id
        }
        console.log(data_dict)
        $.ajax({
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        type: 'POST',
        processData: false,
        contentType: false,
        url: "{% url 'ajax_calls' %}",
        data: JSON.stringify(data_dict),
        success: function(response) {
            if (response['error'] != "0")
            {
                Swal.fire({
                    icon: 'error',
                    title: translate_js('An error has occurred!', "EN"),
                    position: 'center',
                    showConfirmButton: false,
                    text: translate_js(response['error_text'], "EN"),
                })
            }else
            {

                category_row.remove()

                Swal.fire({
                    icon: 'success',
                    title: translate_js("Category successfully deleted!", "EN"),
                    showConfirmButton: false,
                    timer: 1500
                })
            }
            current_categories = get_current_categories()
        }
        })


}
})
})













//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
/////////////////////DECLARE FUNCTIONS////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////

function get_current_regions()
{
    current_regions = ""
    data_dict = {
            "function":"get_current_regions",
            }
            $.ajax({
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            type: 'POST',
            processData: false,
            contentType: false,
            url: "{% url 'ajax_calls' %}",
            data: JSON.stringify(data_dict),
            success: function(response) {
                fetched_regions = response['current_regions'] 
                for (i=0; i<fetched_regions.length; i++)
                {
                    current_regions += '<option value="' + fetched_regions[i]['id'] + '">' + fetched_regions[i]['name'] + '</option>'
                }
                return current_regions
            }
            })
            
}

function get_current_categories()
{
    current_categories = ""
    data_dict = {
            "function":"get_current_categories",
            }
            $.ajax({
            headers: {
                "X-CSRFToken": getCookie("csrftoken")
            },
            type: 'POST',
            processData: false,
            contentType: false,
            url: "{% url 'ajax_calls' %}",
            data: JSON.stringify(data_dict),
            success: function(response) {
                fetched_categories = response['current_categories'] 
                for (i=0; i<fetched_categories.length; i++)
                {
                    current_categories += '<option value="' + fetched_categories[i]['id'] + '">' + fetched_categories[i]['name'] + '</option>'
                }
                return current_categories
            }
            })
            
}


</script>

{% endblock %}